<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KrallÄ±klarÄ±n Terazisi - Ana MenÃ¼</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Inter:wght@400;500;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="menu-style.css">
</head>

<body>
    <div class="menu-container">
        <div class="menu-card">
            <h1 class="game-title">
                <span class="crown">ğŸ‘‘</span>
                KrallÄ±klarÄ±n Terazisi
                <span class="crown">ğŸ‘‘</span>
            </h1>
            <p class="subtitle">v2.0 - Dijital Masa Oyunu</p>

            <div class="mode-tabs">
                <button class="mode-tab active" id="tab-local">YEREL OYUN</button>
                <button class="mode-tab" id="tab-multiplayer">MULTIPLAYER</button>
            </div>

            <div id="content-local">
                <div class="player-selection">
                    <div class="player-buttons">
                        <button class="player-btn" data-players="2">
                            <span class="player-icon">ğŸ‘¥</span>
                            <span class="player-count">2 Oyuncu</span>
                        </button>
                        <button class="player-btn" data-players="3">
                            <span class="player-icon">ğŸ‘¥ğŸ‘¤</span>
                            <span class="player-count">3 Oyuncu</span>
                        </button>
                        <button class="player-btn" data-players="4">
                            <span class="player-icon">ğŸ‘¥ğŸ‘¥</span>
                            <span class="player-count">4 Oyuncu</span>
                        </button>
                    </div>
                </div>

                <div class="selected-info" id="selected-info" style="display: none;">
                    <p>SeÃ§ilen: <strong id="selected-count">2</strong> Oyuncu</p>

                    <div class="bot-selection-inline">
                        <h3 style="font-size: 1rem; margin-bottom: 10px; color: var(--color-gold);">ğŸ¤– Bot SayÄ±sÄ±</h3>
                        <div class="bot-buttons-inline">
                            <button class="bot-btn-small selected" data-bots="0">0</button>
                            <button class="bot-btn-small" data-bots="1">1</button>
                            <button class="bot-btn-small" data-bots="2">2</button>
                            <button class="bot-btn-small" data-bots="3">3</button>
                        </div>
                    </div>

                    <button class="start-btn" id="start-game">
                        âš”ï¸ Oyunu BaÅŸlat
                    </button>
                </div>
            </div>

            <div id="content-multiplayer" style="display: none;">
                <!-- State 1: Login -->
                <div id="mp-login-view" class="multiplayer-panel">
                    <div class="mp-icon">ğŸŒ</div>
                    <h3>Ã‡EVRÄ°MÄ°Ã‡Ä° OYNA</h3>
                    <p style="margin-bottom: 20px;">DÃ¼nyanÄ±n dÃ¶rt bir yanÄ±ndaki krallara meydan oku!</p>

                    <button id="google-login-btn" class="google-btn">
                        <span class="google-icon">
                            <svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"
                                style="display: block;">
                                <path fill="#EA4335"
                                    d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z">
                                </path>
                                <path fill="#4285F4"
                                    d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z">
                                </path>
                                <path fill="#FBBC05"
                                    d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z">
                                </path>
                                <path fill="#34A853"
                                    d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z">
                                </path>
                            </svg>
                        </span>
                        Google ile GiriÅŸ Yap
                    </button>
                    <p style="font-size: 0.75rem; margin-top: 15px; opacity: 0.6;">(Demo: TÄ±klayarak profil
                        oluÅŸturulabilir)</p>
                </div>

                <div class="divider"
                    style="display: flex; align-items: center; justify-content: center; gap: 10px; margin: 20px 0; opacity: 0.5;">
                    <span style="height: 1px; width: 30px; background: white;"></span>
                    <span style="font-size: 0.8rem; color: #ccc;">VEYA</span>
                    <span style="height: 1px; width: 30px; background: white;"></span>
                </div>

                <button id="lan-game-btn" class="secondary-btn"
                    style="width: 100%; border-color: var(--color-gold); background: rgba(0,0,0,0.4);">
                    ğŸ  AynÄ± AÄŸda Oyna (LAN)
                </button>


                <!-- State 3: LAN Lobby (Hidden by default) -->
                <div id="mp-lan-view" class="multiplayer-panel" style="display: none;">
                    <div class="mp-icon">ğŸ“¡</div>
                    <h3 style="margin-bottom: 20px;">Yerel AÄŸ TaranÄ±yor...</h3>

                    <div id="room-list"
                        style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: left; height: 120px; overflow-y: auto;">
                        <div style="color: #64748b; font-size: 0.9rem; text-align: center; padding-top: 30px;">
                            Aktif oyun bulunamadÄ±.<br>
                            <small>AynÄ± Wi-Fi aÄŸÄ±nda olduÄŸunuzdan emin olun.</small>
                        </div>
                    </div>

                    <div style="display: flex; gap: 10px;">
                        <button id="create-room-btn" class="start-btn" style="flex: 1; font-size: 1rem; padding: 12px;">
                            â• Oda Kur
                        </button>
                        <button id="back-to-mp-menu-btn" class="secondary-btn" style="padding: 12px 15px;">
                            â¬…ï¸
                        </button>
                    </div>
                </div>

                <!-- State 4: Active Lobby (Waiting Room) -->
                <div id="mp-lobby-active" class="multiplayer-panel" style="display: none;">
                    <div
                        style="background: rgba(16, 185, 129, 0.2); border: 1px solid #10b981; border-radius: 8px; padding: 10px; margin-bottom: 20px;">
                        <p style="font-size: 0.8rem; color: #10b981; margin-bottom: 5px;">ODA KODU</p>
                        <h2 id="lobby-code" style="font-size: 2rem; letter-spacing: 5px; color: white; margin: 0;">
                            ------
                        </h2>
                    </div>

                    <div id="lobby-player-list" style="text-align: left; margin-bottom: 20px;">
                        <!-- Players will be injected here -->
                        <div class="lobby-player-item">
                            <span class="p-avatar">ğŸ‘‘</span>
                            <span class="p-name">Siz (Kurucu)</span>
                            <span class="p-status ready">HazÄ±r</span>
                        </div>
                    </div>

                    <div style="display: flex; gap: 10px;">
                        <button id="start-mp-game-btn" class="start-btn"
                            style="flex: 1; font-size: 1rem; padding: 12px; filter: grayscale(1);">
                            â³ Oyuncular Bekleniyor...
                        </button>
                        <button id="leave-lobby-btn" class="secondary-btn"
                            style="background: rgba(239, 68, 68, 0.2); border-color: #ef4444;">
                            âŒ
                        </button>
                    </div>
                </div>

                <!-- Socket.io connection script -->
                <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

                <!-- State 2: Profile (Hidden by default) -->
                <div id="mp-profile-view" class="multiplayer-panel" style="display: none;">
                    <div class="profile-header">
                        <img src="https://ui-avatars.com/api/?name=Kral&background=random&size=128" id="user-avatar"
                            class="profile-avatar">
                        <div class="profile-info">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <h3 id="user-name" style="margin: 0; font-size: 1.3rem;">Misafir Kral</h3>
                                <button id="edit-nickname-btn"
                                    style="background:none; border:none; cursor:pointer; font-size:1rem;">âœï¸</button>
                            </div>
                            <input type="text" id="nickname-input"
                                style="display: none; background: rgba(255,255,255,0.1); border: 1px solid var(--color-gold); color: white; padding: 5px; border-radius: 4px; width: 150px; margin-bottom: 5px;"
                                maxlength="15" placeholder="Yeni Ä°sim">
                            <div class="profile-rank" style="color: var(--color-gold); font-size: 0.9rem;">â­ Acemi
                                Komutan</div>
                        </div>
                    </div>

                    <div class="profile-stats-grid">
                        <div class="stat-box">
                            <div class="stat-value">0</div>
                            <div class="stat-label">Galibiyet</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value">0%</div>
                            <div class="stat-label">Kazanma</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value">1000</div>
                            <div class="stat-label">Puan</div>
                        </div>
                    </div>

                    <button class="start-btn" style="margin-top: 25px; width: 100%;">
                        ğŸ” EÅŸleÅŸme Bul
                    </button>

                    <button id="logout-btn" class="secondary-btn"
                        style="margin-top: 15px; width: 100%; border-color: #ef4444; color: #fca5a5;">
                        Ã‡Ä±kÄ±ÅŸ Yap
                    </button>
                </div>
            </div>

            <div class="menu-footer">
                <button class="secondary-btn" onclick="showRules()">ğŸ“œ Kurallar</button>
                <button class="secondary-btn" onclick="showCredits()">â„¹ï¸ HakkÄ±nda</button>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="rules-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('rules-modal')">&times;</span>
            <h2>ğŸ“œ Oyun KurallarÄ±</h2>
            <div class="modal-body">
                <h3>ğŸ° AmaÃ§</h3>
                <p>KrallÄ±klarÄ±n Terazisi'nde amaÃ§, rakiplerini kendine baÄŸlamaktÄ±r (Vasal yapmak). Bir oyuncunun
                    baÅŸkentini (Meclis) ele geÃ§irirsen senin vasalÄ±n olur. TÃ¼m rakipleri vasal yapan kazanÄ±r.</p>

                <h3>ğŸ› ï¸ AraÃ§lar ve Binalar</h3>
                <ul>
                    <li><strong>Meclis (0 AltÄ±n):</strong> BaÅŸkentin. YÄ±kÄ±lÄ±rsa kaybedersin. Sivil barÄ±ndÄ±rÄ±r (Eksilirse
                        kaynakla yeniler).</li>
                    <li><strong>Ã‡iftlik (3 AltÄ±n, 5 HP):</strong> Tur baÅŸÄ±na +1 AltÄ±n verir. Her 3 turda bir 1 Ã¼cretsiz
                        sivil Ã¼retir.</li>
                    <li><strong>KÄ±ÅŸla (4 AltÄ±n, 6 HP):</strong> Asker barÄ±ndÄ±rÄ±r ve Ã¼retir (Max 20).</li>
                    <li><strong>Duvar (5 AltÄ±n, 6 HP):</strong> YÃ¼ksek savunma (20 GÃ¼Ã§) saÄŸlar.</li>
                    <li><strong>Pazar (3 AltÄ±n, 3 HP):</strong> Tur baÅŸÄ±na ekstra altÄ±n geliri saÄŸlar.</li>
                    <li><strong>Bilim Merkezi (5 AltÄ±n, 4 HP):</strong> Teknoloji iÃ§in bilim insanÄ± (1 AltÄ±n/Tur)
                        Ã¼retir.</li>
                </ul>

                <h3>ğŸ“œ Diplomasi KartlarÄ±</h3>
                <p>Diplomasi kartlarÄ± oynandÄ±ÄŸÄ±nda sana <strong>DP (Diplomasi PuanÄ±)</strong> kazandÄ±rÄ±r ve Ã¶zel etkiler
                    yaratÄ±r:</p>
                <ul>
                    <li><strong>Casusluk:</strong> Rakipten kart Ã§almanÄ± saÄŸlar.</li>
                    <li><strong>Propaganda:</strong> Rakibin bir askeri birimini kendi tarafÄ±na Ã§ekersin.</li>
                    <li><strong>Nifak Tohumu:</strong> Ä°ki mÃ¼ttefik arasÄ±ndaki anlaÅŸmayÄ± bozarsÄ±n.</li>
                    <li><strong>Mimari OnarÄ±m:</strong> HasarlÄ± binalarÄ±nÄ± (KÄ±ÅŸla, Duvar) tamir eder.</li>
                    <li><strong>Beyaz Bayrak:</strong> Bir tur boyunca saldÄ±rÄ±lardan korunursun.</li>
                    <li><strong>TerÃ¶r Jokeri:</strong> Rakibin rastgele bir binasÄ±nÄ± yok edersin!</li>
                </ul>

                <h3>ğŸ”¬ Teknolojik GeliÅŸim</h3>
                <p>KrallÄ±ÄŸÄ±nÄ± gÃ¼Ã§lendirmek iÃ§in teknoloji ÅŸarttÄ±r. Teknoloji kartÄ± oynamak iÃ§in:</p>
                <ol>
                    <li><strong>Bilim Merkezi</strong> kurmalÄ±sÄ±n.</li>
                    <li>Merkezde yeterli sayÄ±da <strong>Bilim Ä°nsanÄ±</strong> birikmiÅŸ olmalÄ±.</li>
                </ol>
                <p><strong>GeliÅŸtirmeler:</strong></p>
                <ul>
                    <li><strong>âš”ï¸ Silah:</strong> Askerlerinin saldÄ±rÄ± gÃ¼cÃ¼nÃ¼ katlar (x1.2, x1.5...).</li>
                    <li><strong>ğŸ›¡ï¸ Savunma:</strong> BinalarÄ±nÄ±n dayanÄ±klÄ±lÄ±ÄŸÄ±nÄ± arttÄ±rÄ±r.</li>
                    <li><strong>ğŸ’° Ticaret:</strong> PazarlarÄ±ndan gelen geliri katlar.</li>
                </ul>

                <h3>âš”ï¸ OynanÄ±ÅŸ</h3>
                <ol>
                    <li>Her tur 2 aksiyon hakkÄ±n var.</li>
                    <li>Kart Ã§ekebilir, bina kurabilir veya saldÄ±rabilirsin.</li>
                    <li>Teknoloji geliÅŸtirmek iÃ§in Ã¶nce Bilim Merkezi kurmalÄ± ve bilim insanÄ± biriktirmelisin.</li>
                    <li>Askeri gÃ¼cÃ¼nÃ¼ arttÄ±rarak rakiplerine saldÄ±r ve binalarÄ±nÄ± yÄ±k.</li>
                </ol>

                <h3>ğŸ’¡ Ã–rnek Strateji</h3>
                <p>BaÅŸlangÄ±Ã§ta bir Ã‡iftlik kurarak nÃ¼fus akÄ±ÅŸÄ±nÄ± saÄŸla. ArdÄ±ndan bir Bilim Merkezi ile teknolojiye
                    yatÄ±rÄ±m yap. Savunma iÃ§in Ã¶n cepheye Duvar inÅŸa et ve arkasÄ±na KÄ±ÅŸla koyarak asker biriktir.
                    Rakiplerin altÄ±nÄ± azaldÄ±ÄŸÄ±nda saldÄ±rÄ±ya geÃ§!</p>
            </div>
        </div>
    </div>

    <div id="credits-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('credits-modal')">&times;</span>
            <h2>â„¹ï¸ HakkÄ±nda</h2>
            <div class="modal-body" style="text-align: center;">
                <p class="crown" style="font-size: 3rem; margin: 10px 0;">ğŸ‘‘</p>
                <h3>KrallÄ±klarÄ±n Terazisi</h3>
                <p>Dijital Masa Oyunu - v2.0</p>
                <hr style="border-color: var(--color-gold); opacity: 0.3; margin: 20px 0;">

                <h4 style="color: var(--color-gold);">Oyun Sahibi ve TasarÄ±mcÄ±sÄ±</h4>
                <h2 style="font-family: 'Cinzel', serif; color: white;">YiÄŸit Hamza ERSOY</h2>

                <p style="margin-top: 20px; font-size: 0.9rem; color: #9ca3af;">
                    Bu oyunun tÃ¼m haklarÄ± YiÄŸit Hamza ERSOY'a aittir.<br>
                    Ä°zinsiz kopyalanmasÄ± veya Ã§oÄŸaltÄ±lmasÄ± yasaktÄ±r.
                </p>
                <div style="margin-top: 30px; font-size: 0.8rem; color: #6b7280;">
                    Developed with Antigravity AI
                </div>
            </div>
        </div>
    </div>

    <style>
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(5px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background: linear-gradient(135deg, var(--color-slate-900), #1a1a2e);
            border: 2px solid var(--color-gold);
            border-radius: 12px;
            padding: 2rem;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.2);
            color: var(--color-slate-100);
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 2rem;
            color: var(--color-gold);
            cursor: pointer;
            transition: transform 0.2s;
        }

        .close-modal:hover {
            transform: scale(1.1);
            color: white;
        }

        .modal-body h3 {
            color: var(--color-gold);
            border-bottom: 1px solid rgba(212, 175, 55, 0.3);
            padding-bottom: 5px;
            margin-top: 20px;
        }

        .modal-body ul,
        .modal-body ol {
            padding-left: 20px;
            line-height: 1.6;
        }

        .modal-body li {
            margin-bottom: 8px;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }
    </style>

    <script>
        let selectedPlayers = 2;
        let selectedBots = 0;

        // MODE TABS
        const tabLocal = document.getElementById('tab-local');
        const tabMultiplayer = document.getElementById('tab-multiplayer');
        const contentLocal = document.getElementById('content-local');
        const contentMultiplayer = document.getElementById('content-multiplayer');

        tabLocal.addEventListener('click', () => {
            tabLocal.classList.add('active');
            tabMultiplayer.classList.remove('active');
            contentLocal.style.display = 'block';
            contentMultiplayer.style.display = 'none';
        });

        tabMultiplayer.addEventListener('click', () => {
            tabMultiplayer.classList.add('active');
            tabLocal.classList.remove('active');
            contentLocal.style.display = 'none';
            contentMultiplayer.style.display = 'flex'; // Flex for centering
        });

        // Player selection
        document.querySelectorAll('.player-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                selectedPlayers = parseInt(btn.dataset.players);

                // Update UI
                document.querySelectorAll('.player-btn').forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');

                // Update bot buttons based on player count
                updateBotButtons();
                updateSelection();
            });
        });

        // Bot selection
        document.querySelectorAll('.bot-btn-small').forEach(btn => {
            btn.addEventListener('click', () => {
                selectedBots = parseInt(btn.dataset.bots);

                // Update UI
                document.querySelectorAll('.bot-btn-small').forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');

                updateSelection();
            });
        });

        function updateBotButtons() {
            const maxBots = selectedPlayers - 1; // At least 1 human player
            const botButtons = document.querySelectorAll('.bot-btn-small');

            botButtons.forEach(btn => {
                const botCount = parseInt(btn.dataset.bots);
                if (botCount > maxBots) {
                    btn.style.display = 'none';
                } else {
                    btn.style.display = 'inline-block';
                }
            });

            // Reset bot selection if current selection is invalid
            if (selectedBots > maxBots) {
                selectedBots = 0;
                document.querySelectorAll('.bot-btn-small').forEach(b => b.classList.remove('selected'));
                document.querySelector('.bot-btn-small[data-bots="0"]').classList.add('selected');
            }
        }

        function updateSelection() {
            const totalPlayers = selectedPlayers;
            const humanPlayers = selectedPlayers - selectedBots;

            // Validate: bots can't exceed total players - 1 (at least 1 human)
            if (selectedBots >= selectedPlayers) {
                alert(`âŒ En az 1 insan oyuncu olmalÄ±!\n\nToplam: ${selectedPlayers} oyuncu\nBot: ${selectedBots}\n\nBot sayÄ±sÄ±nÄ± azaltÄ±n.`);
                return;
            }

            document.getElementById('selected-count').textContent = `${humanPlayers} Ä°nsan + ${selectedBots} Bot`;
            document.getElementById('selected-info').style.display = 'block';
        }

        // Start game
        document.getElementById('start-game').addEventListener('click', () => {
            // Validate
            if (selectedBots >= selectedPlayers) {
                alert('En az 1 insan oyuncu olmalÄ±!');
                return;
            }

            // Save to localStorage
            localStorage.setItem('playerCount', selectedPlayers);
            localStorage.setItem('botCount', selectedBots);

            // Navigate to game
            window.location.href = 'game.html';
        });

        // Modal Functions
        function showRules() {
            document.getElementById('rules-modal').style.display = 'flex';
        }

        function showCredits() {
            document.getElementById('credits-modal').style.display = 'flex';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Multiplayer Auth Logic (Mock)
        const googleLoginBtn = document.getElementById('google-login-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const loginView = document.getElementById('mp-login-view');
        const profileView = document.getElementById('mp-profile-view');

        if (googleLoginBtn) {
            googleLoginBtn.addEventListener('click', () => {
                // Simulate Login Process
                googleLoginBtn.innerHTML = '<span class="google-icon">â³</span> GiriÅŸ yapÄ±lÄ±yor...';

                setTimeout(() => {
                    // Switch to Profile View
                    loginView.style.display = 'none';
                    profileView.style.display = 'block';

                    // LOAD XP & Nickname
                    const savedXP = parseInt(localStorage.getItem('krallik_xp')) || 1000;
                    const savedWins = parseInt(localStorage.getItem('krallik_wins')) || 0;
                    const savedNickname = localStorage.getItem('krallik_nickname') || 'Misafir Kral';

                    const nameDisplay = document.getElementById('user-name');
                    if (nameDisplay) nameDisplay.textContent = savedNickname;

                    // Update UI Stats
                    const statValues = document.querySelectorAll('.stat-value');
                    if (statValues.length >= 3) {
                        statValues[0].textContent = savedWins;
                        statValues[1].textContent = savedWins > 0 ? "50%" : "0%";
                        statValues[2].textContent = savedXP;
                    }

                    // Nickname Edit Logic
                    const editBtn = document.getElementById('edit-nickname-btn');
                    const nameInput = document.getElementById('nickname-input');

                    if (editBtn && nameInput && nameDisplay) {
                        editBtn.onclick = () => {
                            if (nameInput.style.display === 'none') {
                                nameInput.style.display = 'block';
                                nameInput.value = nameDisplay.textContent;
                                nameInput.focus();
                                nameDisplay.style.display = 'none';

                                editBtn.textContent = 'KAYDET';
                                editBtn.style.fontSize = '0.75rem';
                                editBtn.style.background = 'var(--color-gold)';
                                editBtn.style.color = '#000';
                                editBtn.style.padding = '4px 10px';
                                editBtn.style.borderRadius = '4px';
                                editBtn.style.fontWeight = 'bold';
                            } else {
                                const newName = nameInput.value.trim() || 'Misafir Kral';
                                nameDisplay.textContent = newName;
                                localStorage.setItem('krallik_nickname', newName); // Save

                                nameInput.style.display = 'none';
                                nameDisplay.style.display = 'block';

                                editBtn.textContent = 'âœï¸';
                                editBtn.style.background = 'none';
                                editBtn.style.color = 'inherit';
                                editBtn.style.padding = '0';
                                editBtn.style.fontSize = '1rem';
                                editBtn.style.fontWeight = 'normal';
                            }
                        };
                    }

                    googleLoginBtn.innerHTML = `
                        <span class="google-icon">
                            <svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" style="display: block;">
                                <path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"></path>
                                <path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"></path>
                                <path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"></path>
                                <path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"></path>
                            </svg>
                        </span>
                        Google ile GiriÅŸ Yap`;
                }, 1000);
            });
        }

        if (logoutBtn) {
            logoutBtn.addEventListener('click', () => {
                profileView.style.display = 'none';
                loginView.style.display = 'block';
            });
        }

        // LAN Game Logic (Navigation)
        const lanGameBtn = document.getElementById('lan-game-btn');
        const backToMenuBtn = document.getElementById('back-to-mp-menu-btn');
        const lanView = document.getElementById('mp-lan-view');

        if (lanGameBtn && lanView) {
            lanGameBtn.addEventListener('click', () => {
                loginView.style.display = 'none';
                lanView.style.display = 'block';
            });
        }

        if (backToMenuBtn) {
            backToMenuBtn.addEventListener('click', () => {
                lanView.style.display = 'none';
                loginView.style.display = 'block';
            });
        }

        /* 
           SOCKET.IO LOGIC 
           Connects to the server serving this page (Standard for LAN)
        */
        const socket = io(); // Connects to window.location.host automatically

        const createRoomBtn = document.getElementById('create-room-btn');
        const lobbyView = document.getElementById('mp-lobby-active');
        const lobbyCodeDisplay = document.getElementById('lobby-code');
        const lobbyPlayerList = document.getElementById('lobby-player-list');
        const startMpGameBtn = document.getElementById('start-mp-game-btn');
        const leaveLobbyBtn = document.getElementById('leave-lobby-btn');

        // Connect when opening LAN view
        if (lanGameBtn) {
            lanGameBtn.addEventListener('click', () => {
                if (!socket.connected) {
                    socket.connect();
                }
            });
        }

        // 1. Create Room
        if (createRoomBtn) {
            createRoomBtn.addEventListener('click', () => {
                const nickname = localStorage.getItem('krallik_nickname') || 'Misafir Oyuncu';
                createRoomBtn.textContent = 'â³ OluÅŸturuluyor...';

                if (socket.connected) {
                    socket.emit('create_room', { nickname });
                } else {
                    socket.connect();
                    setTimeout(() => socket.emit('create_room', { nickname }), 500);
                }
            });
        }

        // Socket Events
        socket.on('connect', () => {
            console.log("Sunucuya baÄŸlanÄ±ldÄ±!");
            socket.emit('get_rooms'); // Request rooms immediately
        });

        socket.on('room_list', (rooms) => {
            const roomListEl = document.getElementById('room-list');
            if (!roomListEl) return;

            if (rooms.length === 0) {
                roomListEl.innerHTML = `
                    <div style="color: #64748b; font-size: 0.9rem; text-align: center; padding-top: 30px;">
                        Aktif oyun bulunamadÄ±.<br>
                        <small>AynÄ± Wi-Fi aÄŸÄ±nda olduÄŸunuzdan emin olun.</small>
                    </div>`;
                return;
            }

            roomListEl.innerHTML = '';
            rooms.forEach(room => {
                const roomItem = document.createElement('div');
                roomItem.style.cssText = 'background: rgba(255,255,255,0.1); padding: 10px; margin-bottom: 5px; border-radius: 4px; display: flex; justify-content: space-between; align-items: center;';
                roomItem.innerHTML = `
                    <div>
                        <div style="font-weight: bold; color: var(--color-gold);">${room.hostName}'in OdasÄ±</div>
                        <div style="font-size: 0.8rem; color: #94a3b8;">${room.playerCount}/4 Oyuncu</div>
                    </div>
                    <button class="join-room-btn secondary-btn" data-room-id="${room.id}" style="padding: 5px 15px; font-size: 0.8rem;">KatÄ±l</button>
                `;
                roomListEl.appendChild(roomItem);
            });

            // Add Click Listeners to Join Buttons
            document.querySelectorAll('.join-room-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const roomId = e.target.getAttribute('data-room-id');
                    const nickname = localStorage.getItem('krallik_nickname') || 'Misafir Oyuncu';
                    socket.emit('join_room', { roomId, nickname });
                });
            });
        });

        socket.on('room_created', (data) => {
            console.log("Oda oluÅŸturuldu:", data);
            updateLobbyUI(data.roomId, data.players);
        });

        socket.on('room_updated', (data) => {
            updateLobbyUI(data.roomId, data.players);
        });

        function updateLobbyUI(roomId, players) {
            if (lanView) lanView.style.display = 'none';
            if (lobbyView) lobbyView.style.display = 'block';

            lobbyCodeDisplay.textContent = roomId;

            // Render Players
            lobbyPlayerList.innerHTML = '';
            players.forEach(p => {
                const item = document.createElement('div');
                item.className = 'lobby-player-item';
                item.style.cssText = `display: flex; align-items: center; background: rgba(0,0,0,0.3); padding: 10px; margin-bottom: 5px; border-radius: 6px; border-left: 4px solid ${p.color};`;
                item.innerHTML = `
                    <span class="p-avatar" style="font-size: 1.5rem; margin-right: 10px;">${p.isHost ? 'ğŸ‘‘' : 'ğŸ‘¤'}</span>
                    <span class="p-name" style="flex: 1; font-weight: bold;">${p.name}</span>
                    <span class="p-status" style="color: ${p.ready ? '#10b981' : '#f59e0b'}; font-size: 0.8rem;">${p.isHost ? 'Kurucu' : 'Bekliyor'}</span>
                `;
                lobbyPlayerList.appendChild(item);
            });

            // Enable Start Button if enough players
            if (players.length >= 2) {
                startMpGameBtn.innerHTML = 'âš”ï¸ OYUNU BAÅLAT';
                startMpGameBtn.style.filter = 'none';
                startMpGameBtn.disabled = false;
            } else {
                startMpGameBtn.innerHTML = 'â³ Oyuncular Bekleniyor...';
                startMpGameBtn.style.filter = 'grayscale(1)';
                startMpGameBtn.disabled = true;
            }
        }

        // Mock Function for testing without server
        function simulateLobby(code, hostname) {
            updateLobbyUI(code, [{
                id: 'host',
                name: hostname,
                isHost: true,
                ready: true,
                color: '#dc2626'
            }]);
        }

        // Leave Lobby
        if (leaveLobbyBtn) {
            leaveLobbyBtn.addEventListener('click', () => {
                if (socket.connected) socket.disconnect();
                lobbyView.style.display = 'none';
                if (lanView) lanView.style.display = 'block';
                createRoomBtn.textContent = 'â• Oda Kur';
            });
        }

        // Click outside to close
        window.onclick = function (event) {
            if (event.target.classList.contains('modal-overlay')) {
                event.target.style.display = 'none';
            }
        }
    </script>
</body>

</html>